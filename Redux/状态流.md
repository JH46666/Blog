# 状态容器与数据流管理

## 三大原则

1. 单一数据源;
2. 状态不可变
3. 纯函数修改状态

先创建 action

actionCreactors = 在用dispatch 调用 action; 

const props = {a:1, b:2}; 
然后：

<Control {...props}/>
就相当于：

<Control a={props.a} b={props.b}>

一般来说，在程序设计中，我们会不知不觉地设定一些简单的协议，来进行两个模块之间的通信。比如A模块传递给B模块一些信息，B模块要根据不同的信息类型来执行不同的操作，我们会这么写：

function notifyB(data) {

    if (data.type === 'add') {}
    else if (data.type === 'remove) {}

}
这样设计，我们就不必为每一种操作都写一个函数，那么这里的data就是一种协议的体现，也就是相当于redux中的action，action是一种只有两个字段type和payload的结构体。显然，创建action结构的函数，就叫做actionCreator。向action的消费方，也就是B模块，传递action的方法，即notifyB，就是一种dispatch的简单示例。

reducer的initState只有在store中不存在这个state的时候才会被用到。preloadState顾名思义就是初始化store数据的，这样就不必在初始化app的时候手动执行多个action去set数据了，比如说从server拉取数据并初始化store，这个参数就是一个很好用的方式。

export导出对象的每个key就是reducer纯函数。合并reducer的API传入的参数就是

prop-type

那么一定有一个类似于 store. makeN ewState 的方法吧？其实， Redux 生成一个全新的页面
状态数据对象进行了拆解，它规定： 当页面需要展现新的数据状态时 ，我们只 需要 dispatch （派
发〉一个 actio （动作／事件）即可。这个 action 其实也是一个 JavaScript 就像页面状态数
据树这个 JavaScript 对象描述了整个页面的状态一样， action 则描述了这个动作单元变化的所有
信息。

使用 reducer 数来接收 action ，并执行页面状态数据树的变更。经 reducer 函数处理之
后， store.getState 方法就会返回新页面的数据状态。

reducer action 需要由开发者编写。 reducer 接收 以下两个参数
当前页面数据状态。
被派发 action
所以这个函数的处理可以抽象表达出来：
(previousState, action) => newState

![redux整体流程](https://tva1.sinaimg.cn/large/007S8ZIlgy1gierr9vr34j30me0f840l.jpg)

在纯函数内不能存在任何副作用，包括但不限于

* 调用系统 API Date.now（） 或者 Math.random（） 等方法。

发送 络请求。

* 在函数体内修改外部变量的值。
* 使用 console.log（）输出信息
* 调用存在副作用的函数等。

我们想象 个很现实的场景 假如发现程序中存在一个 Bug ，页面需要展示数据 1，但是
错误地展示了数据 2, 在Redux 架构下，整个修复思路就变得非常清晰 出现任何问题一定
因为组件接收了不正确的 state ，那么这个 state 生出自 reducer 。我们先来看产生这个错误
state 的 reducer 接收到的 action 内容是否正确，如果正确，则说明 action 准确表达了需要做出的
改变，那么很有可能就是 reducer 数的内部处理出现了错误。

store 就是一个 JavaScript 对象

``` js
store = {
    dispatch,
    getState,
    subscribe,
    replaceReducer
}
```

 dispatch(action ：派发 action
• subscribe(listener 订阅页面数据状态，即 store state 的变化
• getState 获取当前页面状态数据树，即 store 中的 state
• replaceReducer(ne tReduc ）： 一般开发用不到，社区一些热更新或者代码分离技术中可
能会使用到

## createStore 方法可以接收

  • reducer 为开发者编 duc 函数，必需。
  • preloadedState ：页面状态数据树的初始状态，可选
  • enhancer 强器，函数 型，可选
  reducer 数必须存在, 就是说 当开发者 store 同时定义好 reducer
  函数 用来告知 store 数据状态如 根据 action 进行变更

## 构造 action

  action 描述了状态变更的信息， 是需要页面做出的的变化, 这是由开发者定义并借助于
  store.dispatch 派发的 action 本质上也是 JavaScript 对象, 为了清楚 redux 规定 action
  对象需要有一个 type 属性, 作为描述这个 action 的名称来唯一确定这个 action , 一般采用
  JavaScript String 类型 另外， action 往往还需要携带一些数据信息, 这些数据信息的属性名没
  有要求，同时这些数据信息中包含了这个 action 的基本内容。

``` js
const action l = {
    type: ’READ_REDUX_BOOK ', 
    data: {
        book: '深入浅出1'
    }
}
```

## 使用 action creator 
