# 小程序优化指南


##  加快首屏

### 缓存 和 预加载
  缓存是将一些常用的或者上一次请求回来的数据做保存，如 banner，用户信息等。

  下面是小程序的缓存方法
  ```js
    function setWxStorage(key, data) {
      wx.setStorage({
        key,
        data
      });
    }
    function getWxStorage(key) {
      try {
        const value = wx.getStorageSync(key)
        if (value) {
          return value
          // Do something with return value
        }
      } catch (e) {
        console.log('e: ', e);
        // Do something when catch error
      }
    }
  ```
  然后我们在封装请求的方法中进行一下操作
```js
function get(url) {
  this.then = function (resolve, reject) {
    if (url == '/tips') {
      // 避免重复弹出窗口，不做数据缓存
    } else if (url == '/user') {
      // 未授权用户，不做数据缓存
      let user = getWxStorage(url);
      if (user && user.aliasName){
        value && typeof resolve === 'function' && resolve.call(this, user)
      }
    } else {
      let value = getWxStorage(url)
      value && typeof resolve === 'function' && resolve.call(this, value)
    }
    request(url).then(res => {
      typeof resolve === 'function' && resolve.call(this, res)
      setWxStorage(url, res)
    }).catch(err => {
      typeof reject === 'function' && reject.call(this, err)
      throw err
    })
  }
  return this;
}

```

## 性能预估

1. 预估性能问题
2. 监控性能问题
3. 使用工具排查问题
4. 实施性能解决方案

1.从资源包入手，图片的压缩。
我们根据设备的不同特性去选择最优的压缩率，例如jpg、webp，375*大图 小图

下面放几个比较常用的链接：
* tinypng[https://tinypng.com/]
* yasuotu[https://yasuotu.com/]
* 
